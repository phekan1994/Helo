<meta name='viewport' content='width=device-width, initial-scale=1'/><!DOCTYPE html><html lang="hi">
<head>
  <meta charset="UTF-8">
  <meta name='viewport' content='width=device-width, initial-scale=1'/>
  <title>рд╣рд┐рдВрджреА рдПрдЖрдИ рд╕рд╣рд╛рдпрдХ</title>
  <style>
    body {
      font-family: 'Noto Sans Devanagari', sans-serif;
      background-color: #f8f9fa;
      text-align: center;
      padding: 40px;
      color: #212529;
    }
    button {
      font-size: 18px;
      padding: 12px 24px;
      border: none;
      border-radius: 8px;
      background-color: #007bff;
      color: white;
      cursor: pointer;
    }
    #micStatus {
      margin-top: 10px;
      font-weight: bold;
      color: green;
    }
  </style>
</head>
<body>
  <h2>ЁЯОд рдорд╛рдЗрдХ рд╕реЗ рд╣рд┐рдВрджреА рдореЗрдВ рд╕рд╡рд╛рд▓ рдкреВрдЫрд┐рдП</h2>
  <button onclick="startIntro()">ЁЯОЩя╕П рдорд╛рдЗрдХ рдЪрд╛рд▓реВ рдХрд░реЗрдВ</button>
  <p id="micStatus"></p>
  <p><strong>рдЖрдкрдХрд╛ рд╕рд╡рд╛рд▓:</strong> <span id="question">---</span></p>
  <p><strong>рдЙрддреНрддрд░:</strong> <span id="answer">---</span></p>
  <audio id="bgMusic" src="https://cdn.pixabay.com/audio/2022/03/28/audio_365b799070.mp3" preload="auto" loop autoplay></audio>  <script>
    const data = [
      {
        prashn: "рднрд╛рд░рдд рдХреА рд░рд╛рдЬрдзрд╛рдиреА рдХреНрдпрд╛ рд╣реИ ?",
        uttar: "рднрд╛рд░рдд рдХреА рд░рд╛рдЬрдзрд╛рдиреА рдирдИ рджрд┐рд▓реНрд▓реА рд╣реИред",
        keywords: ["рднрд╛рд░рдд", "рд░рд╛рдЬрдзрд╛рдиреА", "рдирдИ", "рджрд┐рд▓реНрд▓реА"],
        focus: "рд░рд╛рдЬрдзрд╛рдиреА",
        details: "рдирдИ рджрд┐рд▓реНрд▓реА рднрд╛рд░рдд рдХреА рд░рд╛рдЬрдзрд╛рдиреА рд╣реИ..."
      },
      {
        prashn: "рднрд╛рд░рдд рдХрд╛ рд░рд╛рд╖реНрдЯреНрд░реАрдп рдкрд╢реБ рдХреМрди рд╣реИ ?",
        uttar: "рднрд╛рд░рдд рдХрд╛ рд░рд╛рд╖реНрдЯреНрд░реАрдп рдкрд╢реБ рдмрд╛рдШ рд╣реИред",
        keywords: ["рд░рд╛рд╖реНрдЯреНрд░реАрдп", "рдкрд╢реБ", "рдмрд╛рдШ", "рдЯрд╛рдЗрдЧрд░"],
        focus: "рдкрд╢реБ",
        details: "рднрд╛рд░рдд рдХрд╛ рд░рд╛рд╖реНрдЯреНрд░реАрдп рдкрд╢реБ рдмрд╛рдШ рд╣реИ..."
      }
      // рдЕрдиреНрдп рдкреНрд░рд╢реНрди рднреА рдЬреИрд╕реЗ рдЖрдкрдиреЗ рдкрд╣рд▓реЗ рдбрд╛рд▓реЗ рдереЗ рд╡реИрд╕реЗ рд╣реА рд░рдЦреЗрдВ
    ];

    const vagueWords = ["рд╡реЛ", "рдЙрд╕рдХрд╛", "рдЙрд╕рдХреЗ", "рдкрд╣рд▓реЗ", "рдмрддрд╛рдУ", "рдХреМрди", "рдирд╛рдо", "рдХреБрдЫ", "рдереЛрдбрд╝рд╛", "рдХреНрдпрд╛", "рдРрд╕рд╛", "рдЙрд╕", "рдЗрд╕", "рдХреИрд╕рд╛", "рдХрд╣реАрдВ", "рдХрднреА", "рдЙрд╕реЗ", "рдЬреИрд╕рд╛", "рдЗрд╕реЗ", "рдЙрдирдХрд╛", "рдЗрд╕рдХрд╛", "рдХрд╣рд┐рдП", "рдмрддрд╛рдирд╛", "рдмрддрд╛рдЗрдП"];

    const detailWords = ["рдбрд┐рдЯреЗрд▓", "details", "рд╡рд┐рд╕реНрддрд╛рд░", "aur", "рдФрд░", "рд╕рдордЭрд╛рдУ", "рдкреВрд░рд╛", "рдЦреБрд▓рдХрд░", "рдЧрд╣рд░рд╛рдИ", "рд╡реНрдпрд╛рдЦреНрдпрд╛", "explain", "рдЬреНрдпрд╛рджрд╛", "detail", "рдЬрд╛рдирдХрд╛рд░реА", "рд╕рдмрдХреБрдЫ", "рдХреГрдкрдпрд╛ рд╡рд┐рд╕реНрддрд╛рд░", "рд╕рдВрдкреВрд░реНрдг", "рдХрд╣рд╛рдиреА", "рдЗрддрд┐рд╣рд╛рд╕", "рдХреИрд╕реЗ", "step", "process", "example", "method", "overview"];

    const historyWords = ["рдкрд┐рдЫрд▓реЗ", "рдкреБрд░рд╛рдиреЗ", "12", "рд╕рд╡рд╛рд▓", "рдХрд┐рдП", "рдХреНрдпрд╛ рдкреВрдЫрд╛", "рджрд┐рдЦрд╛рдУ", "рдЕрдм рддрдХ", "history", "record", "рдкрд╣рд▓реЗ рдкреВрдЫреЗ", "рдпреВрдЬрд╝рд░ рдиреЗ", "рдореБрдЭреЗ", "рд▓рд╛рд╕реНрдЯ", "recent", "рдЕрднреА рддрдХ", "рдмреАрддреЗ", "рдЙрджрд╛рд╣рд░рдг", "list", "рд╕рд╛рд░реА рдмрд╛рддрдЪреАрдд", "рдкреБрд░рд╛рдирд╛ рдЬрд╡рд╛рдм", "рдмрд╛рддрдЪреАрдд", "рдкреБрд░рд╛рдиреА рдмрд╛рддреЗрдВ", "conversation", "logs"];

    let last12Questions = [];
    let lastAnswerObj = null;
    const music = document.getElementById("bgMusic");

    function contains(words, inputWords) {
      return inputWords.some(word => words.includes(word));
    }

    function updateHistory(userQuestion, matchedData) {
      if (last12Questions.length >= 12) last12Questions.shift();
      last12Questions.push({ question: userQuestion, data: matchedData });
    }

    function startIntro() {
      const intro = "рдирдорд╕реНрдХрд╛рд░! рдореИрдВ рдПрдХ рд╣реНрдпреВрдорди рдПрдЖрдИ рдмреНрд░реЗрди рд╣реВрдБ...";
      speakAnswer(intro, () => {
        startListening();
      });
    }

    function startListening() {
      const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
      if (!SpeechRecognition) {
        alert("рдЖрдкрдХрд╛ рдмреНрд░рд╛рдЙрдЬрд╝рд░ рдорд╛рдЗрдХ рдХреЛ рд╕рдкреЛрд░реНрдЯ рдирд╣реАрдВ рдХрд░рддрд╛ред");
        return;
      }

      const recognition = new SpeechRecognition();
      recognition.lang = 'hi-IN';
      recognition.start();
      document.getElementById("micStatus").innerText = "рд╕реБрди рд░рд╣рд╛ рд╣реВрдБ...";

      const silenceTimeout = setTimeout(() => {
        speakAnswer("рдХреГрдкрдпрд╛ рдЖрдк рдЕрдкрдирд╛ рд╕рд╡рд╛рд▓ рдкреВрдЫреЗрдВ, рд╣рдо рдЗрдВрддрдЬрд╝рд╛рд░ рдХрд░ рд░рд╣реЗ рд╣реИрдВред", () => {
          startListening();
        });
      }, 5000);

      recognition.onresult = function(event) {
        clearTimeout(silenceTimeout);
        const userInput = event.results[0][0].transcript.trim();
        document.getElementById("question").innerText = userInput;

        const response = handleSpecialCases(userInput);
        document.getElementById("answer").innerText = response;
        speakAnswer(response, () => {
          startListening();
        });
      };

      recognition.onerror = function(event) {
        alert("рддреНрд░реБрдЯрд┐: " + event.error);
        document.getElementById("micStatus").innerText = "";
      };

      recognition.onend = function() {
        document.getElementById("micStatus").innerText = "";
      };
    }

    function handleSpecialCases(input) {
      const cleaned = input.replace(/[^рдА-ре┐\s]/g, "").trim();
      const inputWords = cleaned.split(/\s+/);

      if (contains(historyWords, inputWords)) {
        if (last12Questions.length === 0) return "рдЕрднреА рддрдХ рдХреЛрдИ рд╕рд╡рд╛рд▓ рдирд╣реАрдВ рдкреВрдЫрд╛ рдЧрдпрд╛ рд╣реИред";
        const historyText = last12Questions.map((item, idx) => `${idx + 1}. ${item.question}`).join(" ");
        return `рдЖрдкрдиреЗ рдЕрдм рддрдХ рдпреЗ рд╕рд╡рд╛рд▓ рдкреВрдЫреЗ рд╣реИрдВ: ${historyText}`;
      }

      if (contains(detailWords, inputWords)) {
        if (lastAnswerObj && lastAnswerObj.details) {
          return lastAnswerObj.details;
        } else {
          let relatedQs = last12Questions.filter(q => {
            return lastAnswerObj && q.data.focus === lastAnswerObj.focus;
          });

          if (relatedQs.length > 0) {
            let extraQs = relatedQs.map((q, i) => `${i + 1}. ${q.question}`).join(" ");
            return `рдорд╛рдл рдХреАрдЬрд┐рдП, рдЗрд╕ рд╡рд┐рд╖рдп рдкрд░ рдореЗрд░реЗ рдкрд╛рд╕ рдЕрднреА рд╡рд┐рд╕реНрддреГрдд рдЬрд╛рдирдХрд╛рд░реА рдЙрдкрд▓рдмреНрдз рдирд╣реАрдВ рд╣реИред рд▓реЗрдХрд┐рди рдЖрдкрдиреЗ рд╣рд╛рд▓ рд╣реА рдореЗрдВ рдЗрд╕рд╕реЗ рд╕рдВрдмрдВрдзрд┐рдд рдпреЗ рд╕рд╡рд╛рд▓ рдкреВрдЫреЗ рд╣реИрдВ: ${extraQs}`;
          } else {
            return "рдорд╛рдл рдХреАрдЬрд┐рдП, рдЗрд╕ рд╡рд┐рд╖рдп рдкрд░ рдореЗрд░реЗ рдкрд╛рд╕ рдЕрднреА рд╡рд┐рд╕реНрддреГрдд рдЬрд╛рдирдХрд╛рд░реА рдЙрдкрд▓рдмреНрдз рдирд╣реАрдВ рд╣реИред";
          }
        }
      }

      if (contains(vagueWords, inputWords)) {
        return "рдХреГрдкрдпрд╛ рдереЛрдбрд╝рд╛ рдФрд░ рд╕реНрдкрд╖реНрдЯ рдмрддрд╛рдПрдВред";
      }

      const matchedAnswer = findAnswer(input);
      if (matchedAnswer) {
        lastAnswerObj = matchedAnswer;
        updateHistory(input, matchedAnswer);
        return matchedAnswer.uttar;
      }

      return "рдорд╛рдл рдХреАрдЬрд┐рдП, рдЗрд╕рдХрд╛ рдЙрддреНрддрд░ рдореЗрд░реЗ рдкрд╛рд╕ рдирд╣реАрдВ рд╣реИред";
    }

    function findAnswer(input) {
      const cleaned = input.replace(/[^рдА-ре┐\s]/g, "").trim();
      const inputWords = cleaned.split(/\s+/);

      let bestMatch = null;
      let highestScore = 0;

      for (let item of data) {
        let matchCount = 0;
        item.keywords.forEach(k => {
          if (inputWords.includes(k)) matchCount++;
        });

        if (inputWords.includes(item.focus) && matchCount >= 2) {
          if (matchCount > highestScore) {
            bestMatch = item;
            highestScore = matchCount;
          }
        }
      }

      return bestMatch;
    }

    function speakAnswer(text, onComplete = null) {
      if ('speechSynthesis' in window) {
        const voices = window.speechSynthesis.getVoices();
        const maleVoice = voices.find(voice => voice.lang.includes('hi-IN') && voice.name.includes('Google рд╣рд┐рдиреНрджреА'));
        const msg = new SpeechSynthesisUtterance(text);
        msg.lang = 'hi-IN';
        msg.rate = 0.94;
        msg.pitch = 1.1;
        if (maleVoice) msg.voice = maleVoice;

        music.volume = 0.1;
        music.play().catch(() => {});

        window.speechSynthesis.cancel();
        window.speechSynthesis.speak(msg);

        msg.onend = function () {
          if (typeof onComplete === "function") {
            onComplete();
          }
        };
      }
    }

    window.speechSynthesis.onvoiceschanged = () => {};
  </script></body>
</html>